"use strict";var kt=Object.defineProperty,Et=Object.defineProperties;var Dt=Object.getOwnPropertyDescriptors;var Xe=Object.getOwnPropertySymbols;var Ct=Object.prototype.hasOwnProperty,Mt=Object.prototype.propertyIsEnumerable;var Ye=(i,e)=>(e=Symbol[i])?e:Symbol.for("Symbol."+i);var Le=(i,e,t)=>e in i?kt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,K=(i,e)=>{for(var t in e||(e={}))Ct.call(e,t)&&Le(i,t,e[t]);if(Xe)for(var t of Xe(e))Mt.call(e,t)&&Le(i,t,e[t]);return i},ne=(i,e)=>Et(i,Dt(e));var ye=(i,e,t)=>Le(i,typeof e!="symbol"?e+"":e,t);var O=(i,e,t)=>new Promise((n,l)=>{var u=s=>{try{r(t.next(s))}catch(c){l(c)}},o=s=>{try{r(t.throw(s))}catch(c){l(c)}},r=s=>s.done?n(s.value):Promise.resolve(s.value).then(u,o);r((t=t.apply(i,e)).next())});var Qe=(i,e,t)=>(e=i[Ye("asyncIterator")])?e.call(i):(i=i[Ye("iterator")](),e={},t=(n,l)=>(l=i[n])&&(e[n]=u=>new Promise((o,r,s)=>(u=l.call(i,u),s=u.done,Promise.resolve(u.value).then(c=>o({value:c,done:s}),r)))),t("next"),t("return"),e);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const z=require("siyuan"),Fe=require("./bilibili-api-Blmsl3ZC.cjs");function x(){}function mt(i){return i()}function Je(){return Object.create(null)}function ie(i){i.forEach(mt)}function ht(i){return typeof i=="function"}function Ee(i,e){return i!=i?e==e:i!==e||i&&typeof i=="object"||typeof i=="function"}let Ae;function ae(i,e){return i===e?!0:(Ae||(Ae=document.createElement("a")),Ae.href=e,i===Ae.href)}function At(i){return Object.keys(i).length===0}function f(i,e){i.appendChild(e)}function Y(i,e,t){i.insertBefore(e,t||null)}function W(i){i.parentNode&&i.parentNode.removeChild(i)}function w(i){return document.createElement(i)}function He(i){return document.createElementNS("http://www.w3.org/2000/svg",i)}function Z(i){return document.createTextNode(i)}function R(){return Z(" ")}function Ke(){return Z("")}function J(i,e,t,n){return i.addEventListener(e,t,n),()=>i.removeEventListener(e,t,n)}function ze(i){return function(e){return e.preventDefault(),i.call(this,e)}}function d(i,e,t){t==null?i.removeAttribute(e):i.getAttribute(e)!==t&&i.setAttribute(e,t)}function Bt(i){return Array.from(i.childNodes)}function te(i,e){e=""+e,i.data!==e&&(i.data=e)}function Ge(i,e){i.value=e==null?"":e}function Ze(i,e,t,n){i.style.setProperty(e,t,"")}function le(i,e,t){i.classList.toggle(e,!!t)}function Tt(i,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(i,{detail:e,bubbles:t,cancelable:n})}let ke;function be(i){ke=i}function Oe(){if(!ke)throw new Error("Function called outside component initialization");return ke}function pe(i){Oe().$$.on_mount.push(i)}function pt(i){Oe().$$.on_destroy.push(i)}function Re(){const i=Oe();return(e,t,{cancelable:n=!1}={})=>{const l=i.$$.callbacks[e];if(l){const u=Tt(e,t,{cancelable:n});return l.slice().forEach(o=>{o.call(i,u)}),!u.defaultPrevented}return!0}}const de=[],ge=[];let he=[];const $e=[],St=Promise.resolve();let Ne=!1;function Pt(){Ne||(Ne=!0,St.then(gt))}function qe(i){he.push(i)}const Ie=new Set;let ce=0;function gt(){if(ce!==0)return;const i=ke;do{try{for(;ce<de.length;){const e=de[ce];ce++,be(e),Lt(e.$$)}}catch(e){throw de.length=0,ce=0,e}for(be(null),de.length=0,ce=0;ge.length;)ge.pop()();for(let e=0;e<he.length;e+=1){const t=he[e];Ie.has(t)||(Ie.add(t),t())}he.length=0}while(de.length);for(;$e.length;)$e.pop()();Ne=!1,Ie.clear(),be(i)}function Lt(i){if(i.fragment!==null){i.update(),ie(i.before_update);const e=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,e),i.after_update.forEach(qe)}}function It(i){const e=[],t=[];he.forEach(n=>i.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),he=e}const Be=new Set;let re;function Ut(){re={r:0,c:[],p:re}}function Ht(){re.r||ie(re.c),re=re.p}function ue(i,e){i&&i.i&&(Be.delete(i),i.i(e))}function fe(i,e,t,n){if(i&&i.o){if(Be.has(i))return;Be.add(i),re.c.push(()=>{Be.delete(i),n&&(t&&i.d(1),n())}),i.o(e)}else n&&n()}function _e(i){return(i==null?void 0:i.length)!==void 0?i:Array.from(i)}function Ve(i,e){i.d(1),e.delete(i.key)}function je(i,e,t,n,l,u,o,r,s,c,a,g){let _=i.length,v=u.length,k=_;const S={};for(;k--;)S[i[k].key]=k;const D=[],E=new Map,N=new Map,y=[];for(k=v;k--;){const h=g(l,u,k),P=t(h);let q=o.get(P);q?y.push(()=>q.p(h,e)):(q=c(P,h),q.c()),E.set(P,D[k]=q),P in S&&N.set(P,Math.abs(k-S[P]))}const M=new Set,V=new Set;function U(h){ue(h,1),h.m(r,a),o.set(h.key,h),a=h.first,v--}for(;_&&v;){const h=D[v-1],P=i[_-1],q=h.key,C=P.key;h===P?(a=h.first,_--,v--):E.has(C)?!o.has(q)||M.has(q)?U(h):V.has(C)?_--:N.get(q)>N.get(C)?(V.add(q),U(h)):(M.add(C),_--):(s(P,o),_--)}for(;_--;){const h=i[_];E.has(h.key)||s(h,o)}for(;v;)U(D[v-1]);return ie(y),D}function Te(i){i&&i.c()}function ve(i,e,t){const{fragment:n,after_update:l}=i.$$;n&&n.m(e,t),qe(()=>{const u=i.$$.on_mount.map(mt).filter(ht);i.$$.on_destroy?i.$$.on_destroy.push(...u):ie(u),i.$$.on_mount=[]}),l.forEach(qe)}function we(i,e){const t=i.$$;t.fragment!==null&&(It(t.after_update),ie(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Nt(i,e){i.$$.dirty[0]===-1&&(de.push(i),Pt(),i.$$.dirty.fill(0)),i.$$.dirty[e/31|0]|=1<<e%31}function De(i,e,t,n,l,u,o=null,r=[-1]){const s=ke;be(i);const c=i.$$={fragment:null,ctx:[],props:u,update:x,not_equal:l,bound:Je(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(s?s.$$.context:[])),callbacks:Je(),dirty:r,skip_bound:!1,root:e.target||s.$$.root};o&&o(c.root);let a=!1;if(c.ctx=t?t(i,e.props||{},(g,_,...v)=>{const k=v.length?v[0]:_;return c.ctx&&l(c.ctx[g],c.ctx[g]=k)&&(!c.skip_bound&&c.bound[g]&&c.bound[g](k),a&&Nt(i,g)),_}):[],c.update(),a=!0,ie(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const g=Bt(e.target);c.fragment&&c.fragment.l(g),g.forEach(W)}else c.fragment&&c.fragment.c();e.intro&&ue(i.$$.fragment),ve(i,e.target,e.anchor),gt()}be(s)}class Ce{constructor(){ye(this,"$$");ye(this,"$$set")}$destroy(){we(this,1),this.$destroy=x}$on(e,t){if(!ht(t))return x;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const l=n.indexOf(t);l!==-1&&n.splice(l,1)}}$set(e){this.$$set&&!At(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function qt(i){let e;return{c(){e=w("div"),e.innerHTML="",d(e,"class","artplayer-app")},m(t,n){Y(t,e,n),i[10](e)},p:x,i:x,o:x,d(t){t&&W(e),i[10](null)}}}function zt(i,e,t){let n=null,l=null;function u(){return O(this,null,function*(){n||(n=(yield Promise.resolve().then(()=>require("./artplayer-DAOzTqI4.cjs")).then(A=>A.artplayer)).default),l||(l=yield Promise.resolve().then(()=>require("./dash-CRTPN63f.cjs")))})}let{app:o}=e,{config:r}=e,s=null,c,a=null,g=0;const _={volume:70,speed:100,loopCount:3};pe(()=>O(this,null,function*(){yield u()}));function v(C=""){const A=K(K({},_),r);return{container:c,url:C,volume:A.volume/100,isLive:!1,muted:!1,autoplay:!0,pip:!0,autoSize:!0,autoMini:!0,setting:!0,flip:!0,playbackRate:!0,aspectRatio:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!0,mutex:!0,backdrop:!0,playsInline:!0,autoPlayback:!0,theme:"var(--b3-theme-primary)",lang:"zh-cn"}}function k(C=""){return O(this,null,function*(){D(),yield u();const A=v(C);return s=new n(A),E(s),s.on("ready",()=>{V(r)}),s})}function S($){return O(this,arguments,function*(C,A={}){D(),yield u();const X=console.warn;console.warn=(...F)=>{var j;(j=F[0])!=null&&j.includes("[CapabilitiesFilter]")||X.apply(console,F)};const p=ne(K({},v(C)),{type:"mpd",customType:{mpd(F,j,T){T.dash&&(T.dash.destroy(),T.dash=null);const I=l.MediaPlayer().create();I.initialize(F,j,T.option.autoplay),T.dash=I,T.on("destroy",()=>{T.dash&&(T.dash.destroy(),T.dash=null),console.warn=X})}}});return s=new n(p),E(s),A.headers&&(s.headers=A.headers),s})}function D(){s&&(s.destroy(!0),s=null)}function E(C){return C.on("video:timeupdate",()=>{if(a&&C.currentTime>=a.end){const A=(r==null?void 0:r.loopCount)||3;if(A>0&&g>=A){a=null,g=0,C.notice.show="循环播放结束";return}C.currentTime=a.start,g++,C.notice.show=`第 ${g}/${A} 次循环`}}),C}function N($){return O(this,arguments,function*(C,A={}){try{a=null,g=0;const X=A.type==="bilibili-dash"||C.endsWith(".mpd");if(X)s=yield S(C,A);else if(!s)s=yield k(C);else{if(s.dash)try{s.dash.destroy(),s.dash=null}catch(p){console.warn("[Player] 清除dash实例失败:",p)}s.option.customType={},s.option.type="",s.url=C}yield new Promise(p=>{const F=()=>{p(),s.off("video:loadeddata",F)};s.on("video:loadeddata",F)}),A.headers&&!X&&(s.headers=A.headers),A.startTime!==void 0&&(A.isLoop&&A.endTime!==void 0?y(A.startTime,A.endTime):y(A.startTime)),s.play()}catch(X){if(console.error("[Player] 播放失败:",X),z.showMessage("播放失败，请重试"),s!=null&&s.container){const p=new CustomEvent("streamError",{detail:{url:C,options:A}});s.container.dispatchEvent(p)}}})}function y(C,A){if(s)try{g=0,a=null,A!==void 0&&(a={start:C,end:A}),s.currentTime=C}catch($){console.error("[Player] 设置播放时间失败:",$),z.showMessage("设置播放时间失败")}}function M(C,A){if(s)try{s.loop=C,A!==void 0&&r&&t(1,r.loopCount=A,r)}catch($){console.error("[Player] 设置循环播放失败:",$)}}function V(C){if(!s)return;const A=K(K({},_),C);s.volume=A.volume/100,s.playbackRate=A.speed/100}function U(C){s&&(s.currentTime=C)}function h(){return(s==null?void 0:s.currentTime)||0}function P(){return O(this,null,function*(){return s?s.getDataURL():null})}pe(()=>{c&&k("")}),pt(()=>{D()});function q(C){ge[C?"unshift":"push"](()=>{c=C,t(0,c)})}return i.$$set=C=>{"app"in C&&t(2,o=C.app),"config"in C&&t(1,r=C.config)},[c,r,o,N,y,M,V,U,h,P,q]}class Ot extends Ce{constructor(e){super(),De(this,e,zt,qt,Ee,{app:2,config:1,play:3,setPlayTime:4,setLoop:5,updateConfig:6,seekTo:7,getCurrentTime:8,getScreenshotDataURL:9})}get play(){return this.$$.ctx[3]}get setPlayTime(){return this.$$.ctx[4]}get setLoop(){return this.$$.ctx[5]}get updateConfig(){return this.$$.ctx[6]}get seekTo(){return this.$$.ctx[7]}get getCurrentTime(){return this.$$.ctx[8]}get getScreenshotDataURL(){return this.$$.ctx[9]}}class me{static convertToFileUrl(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("file://")?e:/^[a-zA-Z]:\\/.test(e)?"file:///"+e.replace(/\\/g,"/"):"file://"+e}static getCachedInfo(e){try{const t=localStorage.getItem(`media_info_${e}`);if(!t)return null;const{timestamp:n,info:l}=JSON.parse(t);return Date.now()-n>this.CACHE_EXPIRY?(localStorage.removeItem(`media_info_${e}`),null):l}catch(t){return null}}static cacheInfo(e,t){if(t)try{localStorage.setItem(`media_info_${e}`,JSON.stringify({timestamp:Date.now(),info:t}))}catch(n){console.error("Failed to cache media info:",n)}}static cleanupCache(){try{const e=Date.now();for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(n!=null&&n.startsWith("media_info_"))try{const{timestamp:l}=JSON.parse(localStorage.getItem(n));e-l>this.CACHE_EXPIRY&&localStorage.removeItem(n)}catch(l){localStorage.removeItem(n)}}}catch(e){console.warn("Failed to cleanup cache:",e)}}static getMediaInfoFromElement(e){return O(this,null,function*(){return new Promise((t,n)=>{const l=this.convertToFileUrl(e),u=this.getMediaType(e),o=document.createElement(u);o.style.display="none",document.body.appendChild(o);let r;const s=()=>O(this,null,function*(){const g=this.formatDuration(o.duration);let _="";if(o instanceof HTMLVideoElement)try{o.currentTime=o.duration/2,yield new Promise(S=>o.addEventListener("seeked",S,{once:!0}));const v=document.createElement("canvas");v.width=o.videoWidth,v.height=o.videoHeight,v.getContext("2d").drawImage(o,0,0,v.width,v.height),_=v.toDataURL("image/jpeg",.7)}catch(v){console.warn("Failed to get video thumbnail:",v)}a(),t({title:this.extractTitleFromUrl(e),duration:g,thumbnail:_,artist:"",artistIcon:""})}),c=()=>{a(),n(new Error("Failed to load media"))},a=()=>{o.removeEventListener("loadedmetadata",s),o.removeEventListener("error",c),o.parentNode&&o.parentNode.removeChild(o),r&&clearTimeout(r)};r=window.setTimeout(()=>{a(),n(new Error("Media load timeout"))},1e4),o.addEventListener("loadedmetadata",s),o.addEventListener("error",c),o.src=l,o.load()})})}static extractTitleFromUrl(e){try{const n=new URL(e).pathname.split("/"),l=n[n.length-1];return decodeURIComponent(l.split(".")[0])||"未知标题"}catch(t){return"未知标题"}}static formatDuration(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60),l=Math.floor(e%60);return t>0?`${t}:${n.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`:`${n}:${l.toString().padStart(2,"0")}`}static getMediaType(e){const t=[".mp4",".webm",".ogg",".mov"],n=[".mp3",".wav",".aac",".m4a"];return t.some(l=>e.toLowerCase().endsWith(l))?"video":n.some(l=>e.toLowerCase().endsWith(l))?"audio":"video"}static createMediaItem(e,t){return O(this,null,function*(){try{const n=this.convertToFileUrl(e);let l=this.getCachedInfo(n);if(l||(n.includes("bilibili.com")?t!=null&&t.aid||t!=null&&t.bvid?l=K(K({},yield Fe.BilibiliParser.getVideoInfo(n)),t):l=yield Fe.BilibiliParser.getVideoInfo(n):l=yield this.getMediaInfoFromElement(n),l&&this.cacheInfo(n,l)),!l)return null;const u=n.includes("bilibili.com")?"bilibili":this.getMediaType(n);return{id:`media-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,title:l.title,artist:l.artist,artistIcon:l.artistIcon,duration:l.duration,thumbnail:l.thumbnail||(u==="audio"?this.DEFAULT_AUDIO_THUMBNAIL:""),url:n,type:u,isPinned:!1,isFavorite:!1,aid:l.aid,bvid:l.bvid,cid:l.cid}}catch(n){return console.error("Failed to create media item:",n),null}})}static getMediaInfoFromItems(e){return e.map(t=>K(K(K({url:t.url},t.aid?{aid:t.aid}:{}),t.bvid?{bvid:t.bvid}:{}),t.cid?{cid:t.cid}:{}))}static createMediaItems(e){return O(this,null,function*(){return(yield Promise.all(e.map(n=>this.createMediaItem(n.url,n)))).filter(n=>n!==null)})}}ye(me,"DEFAULT_AUDIO_THUMBNAIL",`data:image/svg+xml;charset=utf-8,<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
        <path d="M628.905386 769.860427 628.905386 482.261019l169.381759-27.464779C771.308637 311.811584 645.822916 203.633728 494.993179 203.633728c-170.51599 0-308.738475 138.222485-308.738475 308.738875 0 170.516989 138.222485 308.738875 308.738475 308.738875 16.540186 0 32.756191-1.34209 48.589456-3.839397 12.391598-20.573051 34.625524-37.084856 62.858182-44.145869C613.897561 771.276467 621.429455 770.182208 628.905386 769.860427zM551.718919 228.830645l-33.079572 144.922942-33.078373 0-23.62798-144.922942C496.589896 211.497397 551.718919 228.830645 551.718919 228.830645zM494.993179 626.995689c-63.300482 0-114.622086-51.317007-114.622086-114.622886 0-63.30348 51.321604-114.622486 114.622086-114.622486 63.306478 0 114.622486 51.319006 114.622486 114.622486C609.615665 575.678482 558.299457 626.995689 494.993179 626.995689zM494.993179 424.978057c-48.20112 0-87.394147 39.192827-87.394147 87.394546 0 48.20112 39.192827 87.395546 87.394147 87.395546 48.201719 0 87.395946-39.194226 87.395946-87.395546C582.389124 464.170884 543.194698 424.978057 494.993179 424.978057zM494.993179 574.79708c-34.421063 0-62.423477-28.002015-62.423477-62.424476 0-34.421662 28.011408-62.424076 62.423477-62.424076 34.432055 0 62.416082 28.002414 62.416082 62.424076C557.409061 546.795265 529.425034 574.79708 494.993179 574.79708zM534.528574 870.531771c1.499983 8.297374 4.789753 16.008146 9.524542 22.939447-16.073102 2.058604-32.429013 3.239803-49.050144 3.239803-211.934708 0-384.347812-172.417701-384.347812-384.338419 0-211.922716 172.413104-384.338419 384.338019-384.338419 188.118456 0 345.001689 135.905456 377.892189 314.664258l-37.310503 6.059292c-29.969681-160.790984-171.236502-282.919381-340.581686-282.919381-191.084445 0-346.53365 155.451604-346.53365 346.53425 0 191.080048 155.449205 346.53425 346.53365 346.53425 12.796724 0 25.414169-0.748493 37.859731-2.104573C532.968631 861.361189 533.461497 865.948079 534.528574 870.531771zM912.096583 463.425989l0 333.227272c0 27.59629-20.573051 49.609165-52.658098 57.716668-35.234911 8.736077-69.250848-6.021917-75.997274-33.022611-6.760416-27.057655 16.31294-56.065787 51.53386-64.879811 15.920206-3.931335 31.587384-3.128879 44.698494 1.494986L879.673565 557.20001l-180.148459 32.927675-0.834434 249.757065-0.036975 0c-0.156894 23.646767-21.482435 46.868223-52.156438 54.45388-34.814196 8.759061-71.280472-7.807706-75.193819-32.597899-6.691463-26.747865 16.124068-55.470191 51.00222-64.201272 15.699356-3.904353 31.039755-3.119885 43.933013 1.402049L666.238674 503.300354 912.096583 463.425989z" fill="currentColor" style="color:var(--b3-theme-primary)"/></svg>`),ye(me,"CACHE_EXPIRY",24*60*60*1e3);function xe(i,e,t){const n=i.slice();return n[41]=e[t],n}function et(i,e,t){const n=i.slice();return n[44]=e[t],n}function Rt(i){let e,t=i[44].name+"",n,l,u;function o(){return i[21](i[44])}function r(...s){return i[22](i[44],...s)}return{c(){e=w("button"),n=Z(t),d(e,"class","tab"),le(e,"active",i[5]===i[44].id)},m(s,c){Y(s,e,c),f(e,n),l||(u=[J(e,"click",o),J(e,"contextmenu",ze(r))],l=!0)},p(s,c){i=s,c[0]&16&&t!==(t=i[44].name+"")&&te(n,t),c[0]&48&&le(e,"active",i[5]===i[44].id)},d(s){s&&W(e),l=!1,ie(u)}}}function Vt(i){let e,t,n,l,u,o;function r(...c){return i[19](i[44],...c)}function s(...c){return i[20](i[44],...c)}return{c(){e=w("div"),t=w("input"),d(t,"id",n="tab-edit-"+i[44].id),d(t,"type","text"),d(t,"class","tab-input"),t.value=l=i[44].name,d(e,"class","tab-edit-wrapper")},m(c,a){Y(c,e,a),f(e,t),u||(o=[J(t,"blur",r),J(t,"keydown",s)],u=!0)},p(c,a){i=c,a[0]&16&&n!==(n="tab-edit-"+i[44].id)&&d(t,"id",n),a[0]&16&&l!==(l=i[44].name)&&t.value!==l&&(t.value=l)},d(c){c&&W(e),u=!1,ie(o)}}}function tt(i,e){let t,n;function l(r,s){return r[44].isEditing?Vt:Rt}let u=l(e),o=u(e);return{key:i,first:null,c(){t=Ke(),o.c(),n=Ke(),this.first=t},m(r,s){Y(r,t,s),o.m(r,s),Y(r,n,s)},p(r,s){e=r,u===(u=l(e))&&o?o.p(e,s):(o.d(1),o=u(e),o&&(o.c(),o.m(n.parentNode,n)))},d(r){r&&(W(t),W(n)),o.d(r)}}}function jt(i){let e,t,n;return{c(){e=w("button"),e.textContent="+",d(e,"class","tab tab-add")},m(l,u){Y(l,e,u),t||(n=[J(e,"click",i[13].add),J(e,"contextmenu",ze(i[24]))],t=!0)},p:x,d(l){l&&W(e),t=!1,ie(n)}}}function Wt(i){let e,t,n,l;return{c(){e=w("input"),d(e,"type","text"),d(e,"class","tab-input"),Ze(e,"width","100px"),Ze(e,"max-width","100px"),d(e,"placeholder",t=i[10]==="localFolder"?"输入文件夹路径...":"新标签")},m(u,o){Y(u,e,o),i[23](e),n||(l=[J(e,"blur",i[13].save),J(e,"keydown",i[13].save)],n=!0)},p(u,o){o[0]&1024&&t!==(t=u[10]==="localFolder"?"输入文件夹路径...":"新标签")&&d(e,"placeholder",t)},d(u){u&&W(e),i[23](null),n=!1,ie(l)}}}function Xt(i){let e,t=[],n=new Map,l=_e(i[6].items);const u=o=>o[41].id;for(let o=0;o<l.length;o+=1){let r=xe(i,l,o),s=u(r);n.set(s,t[o]=nt(s,r))}return{c(){e=w("div");for(let o=0;o<t.length;o+=1)t[o].c();d(e,"class","playlist-items")},m(o,r){Y(o,e,r);for(let s=0;s<t.length;s+=1)t[s]&&t[s].m(e,null)},p(o,r){r[0]&20545&&(l=_e(o[6].items),t=je(t,r,u,1,o,l,n,e,Ve,nt,null,xe))},d(o){o&&W(e);for(let r=0;r<t.length;r+=1)t[r].d()}}}function Yt(i){let e;return{c(){e=w("div"),e.textContent="暂无媒体文件",d(e,"class","playlist-empty")},m(t,n){Y(t,e,n)},p:x,d(t){t&&W(e)}}}function it(i){let e,t,n,l,u,o,r=i[41].artist+"",s;return{c(){e=w("div"),t=w("img"),u=R(),o=w("span"),s=Z(r),d(t,"class","artist-icon"),ae(t.src,n=i[41].artistIcon||"/images/default-avatar.png")||d(t,"src",n),d(t,"alt",l=i[41].artist),d(e,"class","item-artist")},m(c,a){Y(c,e,a),f(e,t),f(e,u),f(e,o),f(o,s)},p(c,a){a[0]&64&&!ae(t.src,n=c[41].artistIcon||"/images/default-avatar.png")&&d(t,"src",n),a[0]&64&&l!==(l=c[41].artist)&&d(t,"alt",l),a[0]&64&&r!==(r=c[41].artist+"")&&te(s,r)},d(c){c&&W(e)}}}function nt(i,e){let t,n,l,u,o,r,s,c=(e[41].duration||"--:--")+"",a,g,_,v,k=e[41].title+"",S,D,E,N,y,M,V=e[41].url+"",U,h,P,q,C,A=e[41].artist&&it(e);function $(){return e[25](e[41])}function X(...p){return e[26](e[41],...p)}return{key:i,first:null,c(){var p;t=w("div"),n=w("div"),l=w("img"),r=R(),s=w("span"),a=Z(c),g=R(),_=w("div"),v=w("div"),S=Z(k),E=R(),A&&A.c(),N=R(),y=w("div"),M=w("div"),U=Z(V),P=R(),ae(l.src,u=e[41].thumbnail)||d(l,"src",u),d(l,"alt",o=e[41].title),d(s,"class","duration"),d(n,"class","item-thumbnail"),d(v,"class","item-title"),d(v,"title",D=e[41].title),d(M,"class","item-url"),d(M,"title",h=e[41].url),d(y,"class","item-meta-group"),d(_,"class","item-info"),d(t,"class","playlist-item"),le(t,"active",((p=e[0])==null?void 0:p.id)===e[41].id),this.first=t},m(p,F){Y(p,t,F),f(t,n),f(n,l),f(n,r),f(n,s),f(s,a),f(t,g),f(t,_),f(_,v),f(v,S),f(_,E),A&&A.m(_,null),f(_,N),f(_,y),f(y,M),f(M,U),f(t,P),q||(C=[J(t,"click",$),J(t,"contextmenu",ze(X))],q=!0)},p(p,F){var j;e=p,F[0]&64&&!ae(l.src,u=e[41].thumbnail)&&d(l,"src",u),F[0]&64&&o!==(o=e[41].title)&&d(l,"alt",o),F[0]&64&&c!==(c=(e[41].duration||"--:--")+"")&&te(a,c),F[0]&64&&k!==(k=e[41].title+"")&&te(S,k),F[0]&64&&D!==(D=e[41].title)&&d(v,"title",D),e[41].artist?A?A.p(e,F):(A=it(e),A.c(),A.m(_,N)):A&&(A.d(1),A=null),F[0]&64&&V!==(V=e[41].url+"")&&te(U,V),F[0]&64&&h!==(h=e[41].url)&&d(M,"title",h),F[0]&65&&le(t,"active",((j=e[0])==null?void 0:j.id)===e[41].id)},d(p){p&&W(t),A&&A.d(),q=!1,ie(C)}}}function lt(i){let e,t,n;return{c(){e=w("span"),e.textContent="×",d(e,"class","clear-icon")},m(l,u){Y(l,e,u),t||(n=J(e,"click",i[29]),t=!0)},p:x,d(l){l&&W(e),t=!1,n()}}}function Qt(i){let e,t,n,l,u,o,r,s,c,a=[],g=new Map,_,v,k,S,D,E,N,y,M,V,U,h,P,q,C=_e(i[4]);const A=L=>L[44].id;for(let L=0;L<C.length;L+=1){let Q=et(i,C,L),ee=A(Q);g.set(ee,a[L]=tt(ee,Q))}function $(L,Q){return L[7]?Wt:jt}let X=$(i),p=X(i);function F(L,Q){return L[11]?Xt:Yt}let j=F(i),T=j(i),I=i[8]&&lt(i);return{c(){e=w("div"),t=w("div"),n=w("h3"),n.textContent="播放列表",l=R(),u=w("span"),o=Z(i[11]),r=Z(" 个项目"),s=R(),c=w("div");for(let L=0;L<a.length;L+=1)a[L].c();_=R(),v=w("div"),p.c(),k=R(),S=w("div"),T.c(),D=R(),E=w("div"),N=w("div"),y=w("input"),M=R(),I&&I.c(),V=R(),U=w("button"),U.textContent="添加",d(u,"class","playlist-count"),d(t,"class","playlist-header"),d(v,"class","tab-add-wrapper"),d(c,"class","playlist-tabs"),d(S,"class","playlist-content"),d(y,"type","text"),d(y,"class","tab-input playlist-input"),d(y,"placeholder","输入媒体链接..."),d(N,"class","input-wrapper"),d(U,"class","add-btn"),d(E,"class","playlist-footer"),d(e,"class",h="playlist "+i[1]),le(e,"hidden",i[2])},m(L,Q){Y(L,e,Q),f(e,t),f(t,n),f(t,l),f(t,u),f(u,o),f(u,r),f(e,s),f(e,c);for(let ee=0;ee<a.length;ee+=1)a[ee]&&a[ee].m(c,null);f(c,_),f(c,v),p.m(v,null),f(e,k),f(e,S),T.m(S,null),f(e,D),f(e,E),f(E,N),f(N,y),Ge(y,i[8]),f(N,M),I&&I.m(N,null),f(E,V),f(E,U),P||(q=[J(y,"input",i[27]),J(y,"keydown",i[28]),J(U,"click",i[30])],P=!0)},p(L,Q){Q[0]&2048&&te(o,L[11]),Q[0]&8240&&(C=_e(L[4]),a=je(a,Q,A,1,L,C,g,c,Ve,tt,_,et)),X===(X=$(L))&&p?p.p(L,Q):(p.d(1),p=X(L),p&&(p.c(),p.m(v,null))),j===(j=F(L))&&T?T.p(L,Q):(T.d(1),T=j(L),T&&(T.c(),T.m(S,null))),Q[0]&256&&y.value!==L[8]&&Ge(y,L[8]),L[8]?I?I.p(L,Q):(I=lt(L),I.c(),I.m(N,null)):I&&(I.d(1),I=null),Q[0]&2&&h!==(h="playlist "+L[1])&&d(e,"class",h),Q[0]&6&&le(e,"hidden",L[2])},i:x,o:x,d(L){L&&W(e);for(let Q=0;Q<a.length;Q+=1)a[Q].d();p.d(),T.d(),I&&I.d(),P=!1,ie(q)}}}function Jt(i){try{const e=new URL(i),t=e.searchParams.get("t");e.searchParams.delete("t");const n=e.toString();if(!t)return console.log("[PlayList] 无时间参数:",{mediaUrl:n}),{mediaUrl:n};if(t.includes("-")){const[l,u]=t.split("-").map(Number);return console.log("[PlayList] 解析循环片段:",{mediaUrl:n,start:l,end:u}),{mediaUrl:n,startTime:isNaN(l)?void 0:l,endTime:isNaN(u)?void 0:u}}else{const l=Number(t);return console.log("[PlayList] 解析时间戳:",{mediaUrl:n,time:l}),{mediaUrl:n,startTime:isNaN(l)?void 0:l}}}catch(e){return console.error("[PlayList] 解析链接失败:",e),{mediaUrl:i}}}function Kt(i,e,t){let n,l,{items:u=[]}=e,{currentItem:o=null}=e,{configManager:r}=e,{className:s=""}=e,{hidden:c=!1}=e,a=[],g="default",_=!1,v="",k;const S=Re();let D=null,E=0,N="normal";function y(m){return O(this,null,function*(){try{const b=yield r.getConfig();let H;if(m.type==="bilibili"&&m.bvid&&m.cid){const B=yield Fe.BilibiliParser.getProcessedVideoStream(m.bvid,m.cid,0,b);H={url:B.mpdUrl||B.video.url,headers:B.headers,title:m.title,originalUrl:m.originalUrl||m.url,type:B.mpdUrl?"bilibili-dash":"bilibili"}}else H={url:m.url,title:m.title,originalUrl:m.originalUrl||m.url,type:m.type||"video"};H=ne(K({},H),{startTime:m.startTime,endTime:m.endTime,isLoop:m.startTime!==void 0&&m.endTime!==void 0}),S("play",H),t(0,o=m)}catch(b){console.error("[Playlist] 播放失败:",b),z.showMessage("播放失败，请重试")}})}function M(m){return O(this,null,function*(){const b=Date.now();D===m.id&&b-E<300?(yield y(m),D=null,E=0):(D=m.id,E=b,S("select",m))})}pe(()=>O(this,null,function*(){me.cleanupCache(),yield V()}));function V(){return O(this,null,function*(){const m=yield r.load(),b=yield Promise.all(m.playlists.map(H=>O(this,null,function*(){return ne(K({},H),{items:yield me.createMediaItems(H.items||[])})})));t(4,a=b)})}function U(){const m=a.map(b=>({id:b.id,name:b.name,isFixed:b.isFixed,items:me.getMediaInfoFromItems(b.items||[])}));r.updatePlaylists(m)}function h(m){return O(this,null,function*(){var b;try{console.log("[PlayList] 开始解析链接:",m);const{mediaUrl:H,startTime:B,endTime:G}=Jt(m);console.log("[PlayList] 解析结果:",{mediaUrl:H,startTime:B,endTime:G});const oe=(b=n==null?void 0:n.items)==null?void 0:b.find(se=>se.url===H);if(oe){console.log("[PlayList] 使用已存在项:",oe);const se=ne(K({},oe),{startTime:B,endTime:G,originalUrl:m});console.log("[PlayList] 更新后的媒体项:",se),yield y(se);return}const Me=yield me.createMediaItem(H,{startTime:B,endTime:G,originalUrl:m});if(console.log("[PlayList] 创建新媒体项:",Me),!Me){z.showMessage("无法解析媒体文件");return}n&&(t(6,n.items=[...n.items||[],Me],n),yield U()),yield y(Me)}catch(H){console.error("[Playlist] 添加媒体失败:",H),z.showMessage("添加媒体失败")}})}const P={add(){_||(t(7,_=!0),t(10,N="normal"),setTimeout(()=>k==null?void 0:k.focus(),0))},save(m,b){if(m instanceof KeyboardEvent&&m.key!=="Enter")return;const H=m.target,B=H.value.trim();b?t(4,a=a.map(G=>G.id===b.id?ne(K({},G),{name:B||G.name,isEditing:!1}):G)):(B&&(N==="normal"?t(4,a=[...a,{id:`tab-${Date.now()}`,name:B,items:[]}]):N==="localFolder"&&q(B)),t(7,_=!1)),H.value=""},showContextMenu(m,b){const H=new z.Menu("tabContextMenu");b.isFixed||(H.addItem({icon:"iconEdit",label:"重命名",click:()=>{t(4,a=a.map(B=>ne(K({},B),{isEditing:B.id===b.id}))),setTimeout(()=>{const B=document.querySelector(`#tab-edit-${b.id}`);B==null||B.focus(),B==null||B.select()},0)}}),H.addItem({icon:"iconTrashcan",label:"删除",click:()=>{t(4,a=a.filter(B=>B.id!==b.id)),g===b.id&&t(5,g="default")}}),H.addSeparator()),H.addItem({icon:"iconClear",label:"清空",click:()=>{t(4,a=a.map(B=>B.id===b.id?ne(K({},B),{items:[]}):B)),z.showMessage(`已清空"${b.name}"列表`)}}),H.open({x:m.clientX,y:m.clientY})}};function q(m){return O(this,null,function*(){try{const b=`folder-${Date.now()}`,H=m.split(/[/\\]/).pop()||"本地文件夹",B={id:b,name:H,items:[]};t(4,a=[...a,B]),t(5,g=b);try{const G=yield window.showDirectoryPicker();yield C(G,m,b)}catch(G){console.error("选择文件夹失败:",G),z.showMessage("选择文件夹失败")}}catch(b){console.error("处理本地文件夹失败:",b),z.showMessage("处理本地文件夹失败")}})}function C(m,b,H){return O(this,null,function*(){try{if(m.kind!=="directory")return;const se=yield m.entries();let We=0;try{for(var B=Qe(se),G,oe,Me;G=!(oe=yield B.next()).done;G=!1){const[Se,Pe]=oe.value;if(Pe.kind==="file"){if(/\.(mp4|webm|avi|mkv|mov|flv|mp3|wav|ogg|flac)$/i.test(Se)){const Ft=`file://${b}/${Se}`;yield h(Ft),We++}}else Pe.kind==="directory"&&(yield C(Pe,`${b}/${Se}`,H))}}catch(oe){Me=[oe]}finally{try{G&&(oe=B.return)&&(yield oe.call(B))}finally{if(Me)throw Me[0]}}z.showMessage(`已添加文件夹 ${m.name} 中的 ${We} 个媒体文件`)}catch(se){console.error("处理目录失败:",se),z.showMessage("处理目录失败")}})}const A={showContextMenu(m,b){const H=new z.Menu("mediaItemMenu");H.addItem({icon:"iconPlay",label:"播放",click:()=>A.play(b)}),H.addItem({icon:"iconPin",label:b.isPinned?"取消置顶":"置顶",click:()=>A.togglePin(b)}),H.addItem({icon:"iconHeart",label:b.isFavorite?"取消收藏":"收藏",click:()=>A.toggleFavorite(b)}),H.addSeparator(),H.addItem({icon:"iconTrashcan",label:"删除",click:()=>{const B=a.find(G=>G.id===g);if(B){if(B.items=B.items.filter(G=>G.id!==b.id),t(4,a),b.isFavorite){const G=a.find(oe=>oe.id==="favorites");G&&(G.items=G.items.filter(oe=>oe.id!==b.id))}S("play",{url:b.url,originalUrl:b.originalUrl||b.url,startTime:b.startTime,endTime:b.endTime,isLoop:b.startTime!==void 0&&b.endTime!==void 0,type:b.type,bvid:b.bvid,title:b.title})}}}),H.open({x:m.clientX,y:m.clientY})},togglePin(m){const b=a.find(B=>B.id===g);if(!b)return;const H=b.items.map(B=>B.id===m.id?ne(K({},B),{isPinned:!B.isPinned}):B);b.items=[...H.filter(B=>B.isPinned),...H.filter(B=>!B.isPinned)],t(4,a)},toggleFavorite(m){const b=a.find(B=>B.id==="favorites"),H=a.find(B=>B.id===g);!b||!H||(m.isFavorite?b.items=b.items.filter(B=>B.id!==m.id):b.items=[...b.items||[],ne(K({},m),{isFavorite:!0})],H.items=H.items.map(B=>B.id===m.id?ne(K({},B),{isFavorite:!B.isFavorite}):B),t(4,a))},play(m){return O(this,null,function*(){yield y(m)})}};function $(m){return O(this,null,function*(){var b;try{const H=(b=n==null?void 0:n.items)==null?void 0:b.find(B=>B.url===m.url||B.originalUrl===m.originalUrl);if(H)yield y(H),z.showMessage("媒体已在播放列表中，直接播放");else{const B=a.find(G=>G.id===g);if(!B)throw new Error("未找到活动标签页");B.items=[...B.items||[],m],t(4,a),yield y(m),z.showMessage("已添加到播放列表并开始播放")}}catch(H){throw console.error("[Playlist] 处理媒体项失败:",H),z.showMessage("处理媒体失败"),H}})}function X(m){t(15,u=[...u,m]),u.length===1&&y(m)}function p(m){return O(this,null,function*(){const b=m||v.trim();if(!b){z.showMessage("请输入媒体链接");return}yield h(b),m||t(8,v="")})}const F=(m,b)=>P.save(b,m),j=(m,b)=>P.save(b,m),T=m=>{t(5,g=m.id)},I=(m,b)=>P.showContextMenu(b,m);function L(m){ge[m?"unshift":"push"](()=>{k=m,t(9,k)})}const Q=m=>{const b=new z.Menu("addTabMenu");b.addItem({icon:"iconFolder",label:"添加本地文件夹",click:()=>{t(7,_=!0),t(10,N="localFolder"),setTimeout(()=>k==null?void 0:k.focus(),0)}}),b.addItem({icon:"iconCloud",label:"添加阿里云盘",click:()=>{}}),b.addItem({icon:"iconCloud",label:"添加天翼云盘",click:()=>{}}),b.addItem({icon:"iconCloud",label:"添加夸克云盘",click:()=>{}}),b.addItem({icon:"iconHeart",label:"添加B站收藏夹",click:()=>{}}),b.open({x:m.clientX,y:m.clientY})},ee=m=>M(m),_t=(m,b)=>A.showContextMenu(b,m);function yt(){v=this.value,t(8,v)}const bt=m=>m.key==="Enter"&&p(),vt=()=>t(8,v=""),wt=()=>v&&p();return i.$$set=m=>{"items"in m&&t(15,u=m.items),"currentItem"in m&&t(0,o=m.currentItem),"configManager"in m&&t(16,r=m.configManager),"className"in m&&t(1,s=m.className),"hidden"in m&&t(2,c=m.hidden)},i.$$.update=()=>{var m;i.$$.dirty[0]&48&&t(6,n=a.find(b=>b.id===g)),i.$$.dirty[0]&64&&t(11,l=((m=n==null?void 0:n.items)==null?void 0:m.length)||0),i.$$.dirty[0]&16&&a.length>0&&U()},[o,s,c,p,a,g,n,_,v,k,N,l,M,P,A,u,r,$,X,F,j,T,I,L,Q,ee,_t,yt,bt,vt,wt]}class Gt extends Ce{constructor(e){super(),De(this,e,Kt,Qt,Ee,{items:15,currentItem:0,configManager:16,className:1,hidden:2,handleMediaItem:17,addItem:18,handleSubmit:3},null,[-1,-1])}get handleMediaItem(){return this.$$.ctx[17]}get addItem(){return this.$$.ctx[18]}get handleSubmit(){return this.$$.ctx[3]}}function ut(i,e,t){const n=i.slice();return n[21]=e[t],n}function Zt(i){let e;return{c(){e=w("div"),e.textContent="登录B站账号以获取更多功能",d(e,"class","setting-description")},m(t,n){Y(t,e,n)},p:x,d(t){t&&W(e)}}}function $t(i){let e,t,n,l,u,o,r=i[3].uname+"",s,c,a,g,_=i[3].level_info.current_level+"",v,k,S,D,E=i[3].mid+"",N;return{c(){e=w("div"),t=w("img"),l=R(),u=w("div"),o=w("div"),s=Z(r),c=R(),a=w("span"),g=Z("LV"),v=Z(_),k=R(),S=w("div"),D=Z("UID: "),N=Z(E),d(t,"class","user-avatar"),ae(t.src,n=i[3].face)||d(t,"src",n),d(t,"alt","头像"),d(a,"class","user-level"),d(o,"class","user-name"),d(S,"class","user-id"),d(u,"class","user-details"),d(e,"class","user-wrapper")},m(y,M){Y(y,e,M),f(e,t),f(e,l),f(e,u),f(u,o),f(o,s),f(o,c),f(o,a),f(a,g),f(a,v),f(u,k),f(u,S),f(S,D),f(S,N)},p(y,M){M&8&&!ae(t.src,n=y[3].face)&&d(t,"src",n),M&8&&r!==(r=y[3].uname+"")&&te(s,r),M&8&&_!==(_=y[3].level_info.current_level+"")&&te(v,_),M&8&&E!==(E=y[3].mid+"")&&te(N,E)},d(y){y&&W(e)}}}function xt(i){let e,t,n;return{c(){e=w("button"),e.textContent="退出",d(e,"class","b3-button b3-button--outline")},m(l,u){Y(l,e,u),t||(n=J(e,"click",i[7]),t=!0)},p:x,d(l){l&&W(e),t=!1,n()}}}function ei(i){let e,t,n,l,u;return{c(){e=w("button"),t=Z("登录"),d(e,"class","b3-button b3-button--outline"),e.disabled=n=!!i[1]},m(o,r){Y(o,e,r),f(e,t),l||(u=J(e,"click",i[6]),l=!0)},p(o,r){r&2&&n!==(n=!!o[1])&&(e.disabled=n)},d(o){o&&W(e),l=!1,u()}}}function st(i){let e,t,n,l,u,o,r,s,c;return{c(){e=w("div"),t=w("div"),t.innerHTML='<div class="qrcode-title">哔哩哔哩扫码登录</div> <div class="qrcode-description">打开手机客户端扫描二维码</div>',n=R(),l=w("div"),u=w("img"),r=R(),s=w("div"),c=Z(i[4]),d(t,"class","qrcode-header"),ae(u.src,o=i[1])||d(u,"src",o),d(u,"alt","B站登录二维码"),d(s,"class","scan-status"),le(s,"success",i[2]),d(l,"class","qrcode-container"),d(e,"class","bilibili-qrcode")},m(a,g){Y(a,e,g),f(e,t),f(e,n),f(e,l),f(l,u),f(l,r),f(l,s),f(s,c)},p(a,g){g&2&&!ae(u.src,o=a[1])&&d(u,"src",o),g&16&&te(c,a[4]),g&4&&le(s,"success",a[2])},d(a){a&&W(e)}}}function at(i){let e,t=i[21].description+"",n;return{c(){e=w("div"),n=Z(t),d(e,"class","setting-description")},m(l,u){Y(l,e,u),f(e,n)},p(l,u){u&32&&t!==(t=l[21].description+"")&&te(n,t)},d(l){l&&W(e)}}}function ot(i){let e,t,n,l,u,o,r,s,c,a,g;function _(...D){return i[12](i[21],...D)}function v(D,E){return D[21].key==="speed"?ii:ti}let k=v(i),S=k(i);return{c(){var D,E,N,y,M,V;e=w("div"),t=w("div"),n=w("input"),s=R(),c=w("span"),S.c(),d(n,"type","range"),d(n,"min",l=(E=(D=i[21].slider)==null?void 0:D.min)!=null?E:0),d(n,"max",u=(y=(N=i[21].slider)==null?void 0:N.max)!=null?y:100),d(n,"step",o=(V=(M=i[21].slider)==null?void 0:M.step)!=null?V:1),n.value=r=i[21].value,d(c,"class","slider-value"),d(t,"class","slider-wrapper"),d(e,"class","setting-content")},m(D,E){Y(D,e,E),f(e,t),f(t,n),f(t,s),f(t,c),S.m(c,null),a||(g=J(n,"input",_),a=!0)},p(D,E){var N,y,M,V,U,h;i=D,E&32&&l!==(l=(y=(N=i[21].slider)==null?void 0:N.min)!=null?y:0)&&d(n,"min",l),E&32&&u!==(u=(V=(M=i[21].slider)==null?void 0:M.max)!=null?V:100)&&d(n,"max",u),E&32&&o!==(o=(h=(U=i[21].slider)==null?void 0:U.step)!=null?h:1)&&d(n,"step",o),E&32&&r!==(r=i[21].value)&&(n.value=r),k===(k=v(i))&&S?S.p(i,E):(S.d(1),S=k(i),S&&(S.c(),S.m(c,null)))},d(D){D&&W(e),S.d(),a=!1,g()}}}function ti(i){let e=i[21].value+"",t;return{c(){t=Z(e)},m(n,l){Y(n,t,l)},p(n,l){l&32&&e!==(e=n[21].value+"")&&te(t,e)},d(n){n&&W(t)}}}function ii(i){let e=i[21].value/100+"",t,n;return{c(){t=Z(e),n=Z("x")},m(l,u){Y(l,t,u),Y(l,n,u)},p(l,u){u&32&&e!==(e=l[21].value/100+"")&&te(t,e)},d(l){l&&(W(t),W(n))}}}function rt(i){let e,t,n,l,u,o,r;function s(...c){return i[13](i[21],...c)}return{c(){e=w("label"),t=w("input"),l=R(),u=w("span"),d(t,"type","checkbox"),t.checked=n=i[21].value,d(u,"class","checkbox-custom"),d(e,"class","checkbox-wrapper")},m(c,a){Y(c,e,a),f(e,t),f(e,l),f(e,u),o||(r=J(t,"change",s),o=!0)},p(c,a){i=c,a&32&&n!==(n=i[21].value)&&(t.checked=n)},d(c){c&&W(e),o=!1,r()}}}function ct(i,e){let t,n,l,u=e[21].title+"",o,r,s,c,a,g,_=e[21].description&&at(e),v=e[21].type==="slider"&&ot(e),k=e[21].type==="checkbox"&&rt(e);return{key:i,first:null,c(){t=w("div"),n=w("div"),l=w("div"),o=Z(u),r=R(),_&&_.c(),s=R(),v&&v.c(),c=R(),a=w("div"),k&&k.c(),g=R(),d(l,"class","setting-title"),d(n,"class","setting-info"),d(a,"class","setting-control"),d(t,"class","setting-item"),this.first=t},m(S,D){Y(S,t,D),f(t,n),f(n,l),f(l,o),f(n,r),_&&_.m(n,null),f(n,s),v&&v.m(n,null),f(t,c),f(t,a),k&&k.m(a,null),f(t,g)},p(S,D){e=S,D&32&&u!==(u=e[21].title+"")&&te(o,u),e[21].description?_?_.p(e,D):(_=at(e),_.c(),_.m(n,s)):_&&(_.d(1),_=null),e[21].type==="slider"?v?v.p(e,D):(v=ot(e),v.c(),v.m(n,null)):v&&(v.d(1),v=null),e[21].type==="checkbox"?k?k.p(e,D):(k=rt(e),k.c(),k.m(a,null)):k&&(k.d(1),k=null)},d(S){S&&W(t),_&&_.d(),v&&v.d(),k&&k.d()}}}function ni(i){let e,t,n,l,u,o,r,s,c,a,g,_,v,k,S,D,E,N,y,M=[],V=new Map,U,h;function P(T,I){return T[2]&&T[3]?$t:Zt}let q=P(i),C=q(i);function A(T,I){return T[2]?xt:ei}let $=A(i),X=$(i),p=i[1]&&!i[2]&&st(i),F=_e(i[5]);const j=T=>T[21].key;for(let T=0;T<F.length;T+=1){let I=ut(i,F,T),L=j(I);V.set(L,M[T]=ct(L,I))}return{c(){e=w("div"),t=w("div"),n=w("h3"),n.textContent="设置",l=R(),u=w("div"),o=w("button"),o.innerHTML="<span>重置</span>",r=R(),s=w("button"),s.innerHTML="<span>保存</span>",c=R(),a=w("div"),g=w("div"),_=w("div"),v=w("div"),v.textContent="B站账号",k=R(),S=w("div"),C.c(),D=R(),E=w("div"),X.c(),N=R(),p&&p.c(),y=R();for(let T=0;T<M.length;T+=1)M[T].c();d(o,"class","btn"),d(s,"class","btn primary"),d(u,"class","header-actions"),d(t,"class","settings-header"),d(v,"class","setting-title"),d(S,"class","setting-content"),d(_,"class","setting-info"),d(E,"class","setting-control"),d(g,"class","setting-item"),d(a,"class","setting-panel"),d(e,"class","settings"),d(e,"data-name",i[0])},m(T,I){Y(T,e,I),f(e,t),f(t,n),f(t,l),f(t,u),f(u,o),f(u,r),f(u,s),f(e,c),f(e,a),f(a,g),f(g,_),f(_,v),f(_,k),f(_,S),C.m(S,null),f(g,D),f(g,E),X.m(E,null),f(a,N),p&&p.m(a,null),f(a,y);for(let L=0;L<M.length;L+=1)M[L]&&M[L].m(a,null);U||(h=[J(o,"click",i[9]),J(s,"click",i[8])],U=!0)},p(T,[I]){q===(q=P(T))&&C?C.p(T,I):(C.d(1),C=q(T),C&&(C.c(),C.m(S,null))),$===($=A(T))&&X?X.p(T,I):(X.d(1),X=$(T),X&&(X.c(),X.m(E,null))),T[1]&&!T[2]?p?p.p(T,I):(p=st(T),p.c(),p.m(a,y)):p&&(p.d(1),p=null),I&1056&&(F=_e(T[5]),M=je(M,I,j,1,T,F,V,a,Ve,ct,null,ut)),I&1&&d(e,"data-name",T[0])},i:x,o:x,d(T){T&&W(e),C.d(),X.d(),p&&p.d();for(let I=0;I<M.length;I+=1)M[I].d();U=!1,ie(h)}}}function li(i,e,t){let{group:n}=e,{configManager:l}=e,u="",o="",r,s=!1,c=null,a="等待扫码...";pe(()=>()=>{r&&clearInterval(r)});function g(){return O(this,null,function*(){try{const h=yield Fe.BilibiliParser.getLoginQRCode();t(1,u=h.qrcodeData),o=h.qrcode_key,k()}catch(h){z.showMessage(h.message||"获取二维码失败")}})}function _(h){return O(this,null,function*(){t(2,s=!0),h.timestamp,t(3,c=h.userInfo);const P=yield l.getConfig();P.bilibiliLogin={url:h.url,refresh_token:h.refresh_token,timestamp:h.timestamp,userInfo:h.userInfo},yield l.save(),z.showMessage("登录成功")})}function v(){return O(this,null,function*(){t(2,s=!1),t(3,c=null);const h=yield l.getConfig();delete h.bilibiliLogin,yield l.save(),z.showMessage("已退出登录")})}function k(){r&&clearInterval(r),r=window.setInterval(()=>O(this,null,function*(){try{const h=yield Fe.BilibiliParser.checkQRCodeStatus(o);switch(h.code){case 0:clearInterval(r),t(4,a="登录成功"),yield _(h);break;case 86038:clearInterval(r),t(4,a="二维码已失效，请重新获取"),t(1,u="");break;case 86090:t(4,a="二维码已扫描，请在手机上确认登录");break;case 86101:t(4,a="等待扫码...");break;default:t(4,a=h.message||"未知状态")}}catch(h){clearInterval(r),z.showMessage("检查扫码状态失败")}}),3e3)}const S=[{key:"volume",value:70,type:"slider",title:"音量",description:"默认音量大小",slider:{min:0,max:100,step:1}},{key:"speed",value:100,type:"slider",title:"播放速度",description:"默认播放速度",slider:{min:25,max:200,step:25}},{key:"loopCount",value:3,type:"slider",title:"循环次数",description:"片段循环播放次数",slider:{min:1,max:10,step:1}},{key:"insertAtCursor",value:!0,type:"checkbox",title:"插入到光标处",description:"链接插入到光标位置，否则复制到剪贴板"}];let D=[...S];pe(()=>O(this,null,function*(){const h=yield l.load();t(5,D=D.map(P=>{var q;return ne(K({},P),{value:(q=h.settings[P.key])!=null?q:P.value})})),h.bilibiliLogin&&(t(2,s=!0),h.bilibiliLogin.timestamp,t(3,c=h.bilibiliLogin.userInfo))}));const E=Re();function N(){return O(this,null,function*(){const h=D.reduce((P,q)=>ne(K({},P),{[q.key]:q.value}),{});yield l.updateSettings(h),E("changed",{settings:h}),z.showMessage("设置已保存")})}function y(){t(5,D=S.map(P=>K({},P)));const h=D.reduce((P,q)=>ne(K({},P),{[q.key]:q.value}),{});E("changed",{settings:h}),z.showMessage("设置已重置")}function M(h,P){const q=h.target;let C=q.type==="checkbox"?q.checked:Number(q.value);const A=D.findIndex($=>$.key===P.key);A!==-1&&(t(5,D[A].value=C,D),t(5,D))}const V=(h,P)=>M(P,h),U=(h,P)=>M(P,h);return i.$$set=h=>{"group"in h&&t(0,n=h.group),"configManager"in h&&t(11,l=h.configManager)},[n,u,s,c,a,D,g,v,N,y,M,l,V,U]}class ui extends Ce{constructor(e){super(),De(this,e,li,ni,Ee,{group:0,configManager:11})}}function dt(i){let e;return{c(){e=He("path"),d(e,"d","M608.256 321.609143q-41.106286-17.773714-86.308571-17.773714-45.129143 0-86.162286 17.627428-35.401143 15.213714-63.341714 41.618286v-9.947429q0-14.043429-10.020572-23.990857-9.874286-9.801143-23.771428-9.801143t-23.844572 10.020572q-10.020571 9.947429-10.020571 23.771428V470.308571q0 14.116571 10.020571 24.064 9.947429 9.801143 23.844572 9.801143h117.174857q14.043429 0 23.990857-10.020571 9.801143-9.947429 9.801143-23.844572 0-13.824-10.020572-23.844571-9.947429-9.947429-23.771428-9.947429h-43.885715q19.602286-25.746286 48.859429-40.228571 33.645714-16.603429 71.460571-13.750857 50.980571 3.876571 87.478858 40.521143 36.571429 36.571429 40.082285 87.478857 4.242286 60.416-37.010285 104.448-40.96 43.885714-100.937143 43.885714-43.739429 0-79.36-25.161143-34.742857-24.576-49.883429-64.365714-4.388571-11.702857-14.409143-18.797714-10.093714-7.094857-22.308571-7.094857-20.187429 0-32.182857 16.530285-11.922286 16.676571-4.973715 35.401143 24.137143 65.097143 81.334858 104.155429 58.733714 40.155429 130.413714 37.156571 84.260571-33.364571 144.457143-63.561143 60.196571-60.050286 63.634285-144.091428 1.828571-45.494857-14.482285-87.332572-15.725714-40.374857-45.933715-71.68-30.208-31.232-69.924571-48.420571z")},m(t,n){Y(t,e,n)},d(t){t&&W(e)}}}function si(i){let e,t,n,l,u,o,r,s,c,a,g,_,v=(i[0]||"未播放")+"",k,S,D,E,N,y,M,V,U=!i[1]&&dt();return{c(){e=w("div"),t=w("div"),n=w("button"),n.innerHTML='<svg viewBox="0 0 1024 1024" class="icon"><path d="M853.333333 170.666667a73.142857 73.142857 0 0 1 73.142857 73.142857v536.380952a73.142857 73.142857 0 0 1-73.142857 73.142857H170.666667a73.142857 73.142857 0 0 1-73.142857-73.142857V243.809524a73.142857 73.142857 0 0 1 73.142857-73.142857h682.666666z m0 73.142857H170.666667v536.380952h682.666666V243.809524z m-375.856762 168.057905l120.685715 120.685714 51.687619-51.712 172.422095 172.373333-51.712 51.736381-120.685714-120.685714-51.736381 51.736381-120.685715-120.685714-224.109714 224.109714-51.712-51.687619 275.846095-275.870476zM731.428571 292.571429a48.761905 48.761905 0 1 1 0 97.523809 48.761905 48.761905 0 0 1 0-97.523809z"></path></svg>',l=R(),u=w("button"),u.innerHTML='<svg viewBox="0 0 1024 1024" class="icon"><path d="M511.292952 121.904762c80.408381 0 155.087238 24.405333 217.136762 66.218667l-49.737143 49.785904a318.756571 318.756571 0 0 0-167.399619-47.152762C334.189714 190.756571 190.610286 334.57981 190.610286 512s143.60381 321.243429 320.682666 321.243429c177.103238 0 320.682667-143.823238 320.682667-321.243429 0-49.127619-11.02019-95.695238-30.72-137.337905l51.102476-51.078095A388.87619 388.87619 0 0 1 900.681143 512c0 215.454476-174.32381 390.095238-389.36381 390.095238C296.228571 902.095238 121.904762 727.454476 121.904762 512S296.228571 121.904762 511.292952 121.904762z m0 137.679238c42.179048 0 81.968762 10.386286 116.906667 28.769524l-51.955809 51.931428a182.54019 182.54019 0 0 0-64.950858-11.849142c-101.180952 0-183.247238 82.16381-183.247238 183.56419 0 101.376 82.041905 183.588571 183.247238 183.588571s183.247238-82.212571 183.247238-183.588571a185.295238 185.295238 0 0 0-2.194285-28.42819l56.344381-56.32c9.435429 26.477714 14.57981 55.003429 14.579809 84.74819 0 139.410286-112.810667 252.416-251.977143 252.416-139.142095 0-251.952762-113.005714-251.952762-252.416s112.810667-252.416 251.952762-252.416zM853.577143 143.433143L902.095238 192.146286 566.613333 527.676952l-51.102476 2.681905 2.535619-51.297524 335.481905-335.62819z"></path></svg>',o=R(),r=w("button"),s=He("svg"),c=He("path"),U&&U.c(),a=R(),g=w("div"),_=w("span"),k=Z(v),S=R(),D=w("div"),E=w("button"),E.innerHTML='<svg viewBox="0 0 1024 1024" class="icon"><path d="M414.47619 121.904762a73.142857 73.142857 0 0 1 73.142858 73.142857v219.428571a73.142857 73.142857 0 0 1-73.142858 73.142858H195.047619a73.142857 73.142857 0 0 1-73.142857-73.142858V195.047619a73.142857 73.142857 0 0 1 73.142857-73.142857h219.428571zM195.047619 195.047619v219.428571h219.428571V195.047619H195.047619z m219.428571 341.333333a73.142857 73.142857 0 0 1 73.142858 73.142858v219.428571a73.142857 73.142857 0 0 1-73.142858 73.142857H195.047619a73.142857 73.142857 0 0 1-73.142857-73.142857v-219.428571a73.142857 73.142857 0 0 1 73.142857-73.142858h219.428571z m-219.428571 73.142858v219.428571h219.428571v-219.428571H195.047619zM536.380952 182.857143v73.142857h353.52381v-73.142857H536.380952zM536.380952 609.52381v73.142857h353.52381v-73.142857H536.380952z m0-268.190477v73.142857h353.52381v-73.142857H536.380952z m0 426.666667v73.142857h353.52381v-73.142857H536.380952z"></path></svg>',N=R(),y=w("button"),y.innerHTML='<svg viewBox="0 0 1024 1024" class="icon"><path d="M448.487619 97.52381l130.096762 0.170666c40.399238 0.073143 73.142857 32.792381 73.191619 73.216l0.048762 21.211429a345.283048 345.283048 0 0 1 71.143619 39.960381l17.408-10.044953a73.313524 73.313524 0 0 1 99.961905 26.819048l65.219047 112.566857a73.313524 73.313524 0 0 1-22.893714 97.816381l-3.974095 2.438095-17.481143 10.093715a341.479619 341.479619 0 0 1-1.292191 83.968l12.361143 7.168a73.313524 73.313524 0 0 1 28.867048 96.329142l-2.023619 3.803429-61.098667 105.813333a73.313524 73.313524 0 0 1-96.329143 28.867048l-3.803428-2.048-16.896-9.752381a341.918476 341.918476 0 0 1-68.291048 38.083048l0.024381 29.062095a73.313524 73.313524 0 0 1-68.754286 73.264762l-4.632381 0.146285-130.121142-0.170666a73.313524 73.313524 0 0 1-73.191619-73.216l-0.048762-35.035429a346.599619 346.599619 0 0 1-57.368381-34.035809l-31.158857 17.944381a73.313524 73.313524 0 0 1-99.986286-26.819048l-65.219048-112.566857a73.313524 73.313524 0 0 1 22.918095-97.816381l3.949715-2.438095 31.719619-18.285715c-2.438095-23.161905-2.56-46.665143-0.219429-70.119619l-35.206095-20.333714a73.313524 73.313524 0 0 1-28.891429-96.329143l2.048-3.803428 61.098667-105.813334a73.313524 73.313524 0 0 1 96.329143-28.867047l3.803429 2.048 30.72 17.724952a341.284571 341.284571 0 0 1 64.609523-39.716571l-0.048762-27.89181a73.313524 73.313524 0 0 1 68.754286-73.264762L448.487619 97.52381z m-0.097524 73.313523l0.073143 74.48381-42.130286 19.846095c-18.041905 8.46019-35.05981 18.919619-50.761142 31.158857l-38.936381 30.403048-71.655619-41.398857-1.852953-1.024-61.074286 105.813333 76.239239 44.007619-4.729905 47.104a268.434286 268.434286 0 0 0 0.170666 55.100952l5.022477 47.445334-73.069715 42.081524 65.194667 112.566857 72.557714-41.740191 38.473143 28.184381a272.579048 272.579048 0 0 0 45.226667 26.819048l42.057143 19.772952 0.146285 81.529905 130.072381 0.170667-0.073143-78.019048 45.202286-18.822095a268.629333 268.629333 0 0 0 53.638095-29.915429l38.448762-27.648 57.904762 33.426286 61.049905-105.813333-55.100952-31.890286 6.826666-48.88381a268.190476 268.190476 0 0 0 1.024-65.950476l-5.12-47.494095 58.928762-34.011429-65.219047-112.566857L718.262857 319.390476l-38.497524-28.086857a272.62781 272.62781 0 0 0-56.051809-31.50019l-45.104762-18.724572-0.121905-70.070857-130.096762-0.170667z m145.895619 210.407619a146.773333 146.773333 0 0 1 53.686857 200.362667 146.407619 146.407619 0 0 1-200.167619 53.638095 146.773333 146.773333 0 0 1-53.662476-200.362666 146.407619 146.407619 0 0 1 200.167619-53.638096z m-136.655238 90.258286a73.48419 73.48419 0 0 0 26.86781 100.278857 73.118476 73.118476 0 0 0 99.961904-26.770285c19.529143-33.865143 9.020952-76.824381-23.186285-98.03581l-3.657143-2.267429-3.803429-2.048a73.118476 73.118476 0 0 0-96.182857 28.842667z"></path></svg>',d(n,"class","control-btn"),d(n,"title","截图"),d(u,"class","control-btn"),d(u,"title","添加时间戳"),d(c,"d","M1020.562286 846.555429q0 43.885714-43.885715 43.885714h-50.029714v85.284571q0 18.212571-12.873143 31.085715t-31.012571 12.873142q-43.885714 0-43.885714-43.885714v-85.357714H140.726857q-43.885714 0-43.885714-43.885714V215.04H45.348571q-43.885714 0-43.885714-43.885714t43.885714-43.885715h51.565715V48.493714q0-43.885714 43.885714-43.885714t43.885714 43.885714V127.268571h698.148572q18.139429 0 31.012571 12.873143 12.8 12.873143 12.8 31.012572v631.588571h50.102857q43.885714 0 43.885715 43.812572z m-181.686857-43.885715V215.04H184.612571v587.702857h654.262858z"),d(s,"viewBox","0 0 1024 1024"),d(s,"class","icon"),d(r,"class","control-btn"),d(r,"title","循环片段"),d(t,"class","left-controls"),d(_,"class","media-title"),d(g,"class","title-area"),d(E,"class","control-btn"),d(E,"title","播放列表"),d(y,"class","control-btn"),d(y,"title","设置"),d(D,"class","right-controls"),d(e,"class","control-bar")},m(h,P){Y(h,e,P),f(e,t),f(t,n),f(t,l),f(t,u),f(t,o),f(t,r),f(r,s),f(s,c),U&&U.m(s,null),f(e,a),f(e,g),f(g,_),f(_,k),f(e,S),f(e,D),f(D,E),f(D,N),f(D,y),M||(V=[J(n,"click",i[2]),J(u,"click",i[3]),J(r,"click",i[4]),J(E,"click",i[5]),J(y,"click",i[6])],M=!0)},p(h,[P]){h[1]?U&&(U.d(1),U=null):U||(U=dt(),U.c(),U.m(s,null)),P&1&&v!==(v=(h[0]||"未播放")+"")&&te(k,v)},i:x,o:x,d(h){h&&W(e),U&&U.d(),M=!1,ie(V)}}}function ai(i,e,t){const n=Re();let{title:l=null}=e,{loopStartTime:u=null}=e;function o(){if(!l){z.showMessage("请先播放媒体");return}n("screenshot")}function r(){if(!l){z.showMessage("请先播放媒体");return}n("timestamp")}function s(){if(!l){z.showMessage("请先播放媒体");return}u===null?(n("loopSegment",{action:"start"}),z.showMessage("已记录循环片段开始时间")):(n("loopSegment",{action:"end"}),z.showMessage("已记录循环片段结束时间"))}function c(){n("playlist")}function a(){n("settings")}return i.$$set=g=>{"title"in g&&t(0,l=g.title),"loopStartTime"in g&&t(1,u=g.loopStartTime)},[l,u,o,r,s,c,a]}class oi extends Ce{constructor(e){super(),De(this,e,ai,si,Ee,{title:0,loopStartTime:1})}}function ft(i){let e,t;return e=new ui({props:{group:"mediaPlayer",configManager:i[1]}}),e.$on("changed",i[12]),{c(){Te(e.$$.fragment)},m(n,l){ve(e,n,l),t=!0},p(n,l){const u={};l&2&&(u.configManager=n[1]),e.$set(u)},i(n){t||(ue(e.$$.fragment,n),t=!0)},o(n){fe(e.$$.fragment,n),t=!1},d(n){we(e,n)}}}function ri(i){var N;let e,t,n,l,u,o,r,s,c,a,g,_,v,k,S={app:i[0],config:i[8]};l=new Ot({props:S}),i[17](l),r=new oi({props:{title:(N=i[6])==null?void 0:N.title,loopStartTime:i[9]}}),r.$on("screenshot",i[14]),r.$on("timestamp",i[14]),r.$on("loopSegment",i[14]),r.$on("playlist",i[14]),r.$on("settings",i[14]);let D={configManager:i[1],currentItem:i[6],className:"playlist-container",hidden:!i[4]};a=new Gt({props:D}),i[18](a),a.$on("select",i[13]),a.$on("play",i[15]);let E=i[5]&&ft(i);return{c(){e=w("div"),t=w("div"),n=w("div"),Te(l.$$.fragment),u=R(),o=w("div"),Te(r.$$.fragment),s=R(),c=w("div"),Te(a.$$.fragment),g=R(),E&&E.c(),d(o,"class","control-bar"),le(o,"hidden",!i[3]),d(n,"class","player-area"),d(c,"class","sidebar"),le(c,"show",i[4]||i[5]),d(t,"class","content-area"),le(t,"with-sidebar",i[4]||i[5]),d(e,"class","media-player-tab")},m(y,M){Y(y,e,M),f(e,t),f(t,n),ve(l,n,null),f(n,u),f(n,o),ve(r,o,null),f(t,s),f(t,c),ve(a,c,null),f(c,g),E&&E.m(c,null),_=!0,v||(k=[J(e,"mousemove",i[10]),J(e,"mouseleave",i[11])],v=!0)},p(y,[M]){var P;const V={};M&1&&(V.app=y[0]),M&256&&(V.config=y[8]),l.$set(V);const U={};M&64&&(U.title=(P=y[6])==null?void 0:P.title),M&512&&(U.loopStartTime=y[9]),r.$set(U),(!_||M&8)&&le(o,"hidden",!y[3]);const h={};M&2&&(h.configManager=y[1]),M&64&&(h.currentItem=y[6]),M&16&&(h.hidden=!y[4]),a.$set(h),y[5]?E?(E.p(y,M),M&32&&ue(E,1)):(E=ft(y),E.c(),ue(E,1),E.m(c,null)):E&&(Ut(),fe(E,1,1,()=>{E=null}),Ht()),(!_||M&48)&&le(c,"show",y[4]||y[5]),(!_||M&48)&&le(t,"with-sidebar",y[4]||y[5])},i(y){_||(ue(l.$$.fragment,y),ue(r.$$.fragment,y),ue(a.$$.fragment,y),ue(E),_=!0)},o(y){fe(l.$$.fragment,y),fe(r.$$.fragment,y),fe(a.$$.fragment,y),fe(E),_=!1},d(y){y&&W(e),i[17](null),we(l),we(r),i[18](null),we(a),E&&E.d(),v=!1,ie(k)}}}function ci(){return O(this,null,function*(){return(yield Promise.resolve().then(()=>require("./bilibili-api-Blmsl3ZC.cjs"))).BilibiliParser})}function di(){var t;const i=window.getSelection();if(!(i!=null&&i.focusNode))throw new Error("未找到光标位置");let e=i.focusNode;for(;e&&!((t=e.dataset)!=null&&t.nodeId);)e=e.parentElement;if(!(e!=null&&e.dataset.nodeId))throw new Error("未找到目标块");return e.dataset.nodeId}function Ue(i,e=!1){if(isNaN(i))return"0:00";const t=e?Math.round(i):Number(i.toFixed(1)),n=Math.floor(t/3600),l=Math.floor(t%3600/60),u=e?Math.floor(t%60):Number((t%60).toFixed(1));return n>0?`${n}:${l.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`:`${l}:${u.toString().padStart(2,"0")}`}function fi(i,e){return O(this,null,function*(){const t=new FormData;t.append("file[]",i,e);const n=yield fetch("/api/asset/upload",{method:"POST",body:t});if(!n.ok)throw new Error("上传图片失败");const l=yield n.json();if(l.code!==0)throw new Error(l.msg||"上传图片失败");return l.data.succMap[e]})}function mi(i,e,t){let{app:n}=e,{configManager:l}=e,{linkHandler:u}=e,o=!0,r,s=!1,c=!1,a=null,g,_,v=null,k;function S(p){return O(this,null,function*(){var F;try{if((F=(yield l.getConfig()).settings.insertAtCursor)!=null?F:!0){const I=di();if(!(yield fetch("/api/block/updateBlock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:p,dataType:"markdown",id:I})})).ok)throw new Error("更新块失败");z.showMessage("链接已插入")}else yield navigator.clipboard.writeText(p),z.showMessage("链接已复制到剪贴板")}catch(j){yield navigator.clipboard.writeText(p),z.showMessage("插入失败，已复制到剪贴板")}})}function D(p,F){var j,T;if(!g)return null;try{const I=(j=F.startTime)!=null?j:g.getCurrentTime(),L=(T=F.endTime)!=null?T:F.isLoop?I+3:void 0,Q=p.originalUrl||p.url;if(!Q)throw new Error("无法获取媒体链接");const ee=new URL(Q);return ee.searchParams.delete("t"),F.isLoop&&L?(ee.searchParams.set("t",`${I.toFixed(1)}-${L.toFixed(1)}`),`- [${Ue(I,!0)}-${Ue(L,!0)}](${ee.toString()})`):(ee.searchParams.set("t",I.toFixed(1)),`- [${Ue(I,!0)}](${ee.toString()})`)}catch(I){return z.showMessage("生成链接失败"),null}}function E(){return O(this,null,function*(){if(!g)return null;try{const p=yield g.getScreenshotDataURL();return p?yield(yield fetch(p)).blob():null}catch(p){return null}})}const N=()=>{t(3,o=!0),clearTimeout(r),r=window.setTimeout(()=>t(3,o=!1),3e3)},y=()=>{clearTimeout(r),t(3,o=!1)},M=p=>{const{settings:F}=p.detail;t(8,_=F),g==null||g.updateConfig(F)},V=p=>{t(6,a=p.detail)};function U(p){return O(this,null,function*(){const F=p.type.replace(":","");if(["screenshot","timestamp","loopSegment"].includes(F)&&(!g||!a)){z.showMessage("请先播放媒体");return}switch(F){case"screenshot":yield h();break;case"timestamp":yield P();break;case"loopSegment":yield q();break;case"playlist":t(4,s=!s),s&&t(5,c=!1);break;case"settings":t(5,c=!c),c&&t(4,s=!1);break}})}function h(){return O(this,null,function*(){try{const p=yield E();if(!p){z.showMessage("截图失败，请确保视频正在播放");return}const F=new Date().getTime(),j=`${a.title||"screenshot"}_${F}.png`,T=yield fi(p,j);yield S(`![${j}](${T})`),z.showMessage("截图已插入")}catch(p){z.showMessage("截图失败，请重试")}})}function P(){return O(this,null,function*(){const p=D(a,{isLoop:!1,count:0});p&&(yield S(p))})}function q(){return O(this,null,function*(){const p=g.getCurrentTime();if(v===null)t(9,v=p),z.showMessage("已记录循环片段开始时间");else{const F=D(a,{isLoop:!0,startTime:v,endTime:p,count:_.loopCount});F&&(yield S(F)),t(9,v=null)}})}function C(p){return O(this,null,function*(){const F=p.detail;if(!(F!=null&&F.url)){z.showMessage("无效的播放选项");return}try{t(6,a={id:`item-${Date.now()}`,title:F.title||"未命名媒体",url:F.url,originalUrl:F.originalUrl||F.url,type:F.type==="bilibili-dash"||F.type==="bilibili"?"bilibili":"video",startTime:F.startTime,endTime:F.endTime,isLoop:F.isLoop,loopCount:F.loopCount,bvid:F.bvid}),F.type==="bilibili-dash"||F.type==="bilibili"?yield g.play(F.url,{type:F.type,headers:F.headers,title:F.title}):yield g.play(F.url),F.startTime!==void 0&&g.setPlayTime(F.startTime,F.endTime),F.isLoop&&g.setLoop(!0,F.loopCount)}catch(j){z.showMessage("播放失败："+j.message)}})}function A(p){return O(this,null,function*(){const{type:F}=p.detail;if(F==="bilibili"&&(a!=null&&a.bvid)&&(a!=null&&a.cid))try{const j=yield l.getConfig(),I=yield(yield ci()).getProcessedVideoStream(a.bvid,a.cid,0,j);if(g){const L=I.mpdUrl||I.video.url,Q=I.mpdUrl?"bilibili-dash":"bilibili";g.play(L,{type:Q,headers:I.headers,title:a.title})}}catch(j){z.showMessage("视频播放失败，请稍后重试")}})}pe(()=>(O(this,null,function*(){const F=yield l.load();t(8,_=F.settings),_.loopCount||t(8,_.loopCount=3,_);const j=document.querySelector(".artplayer-app");j&&j.addEventListener("streamError",A)}),()=>{const F=document.querySelector(".artplayer-app");F&&F.removeEventListener("streamError",A)})),pt(()=>{u&&u.setPlaylist(null)});function $(p){ge[p?"unshift":"push"](()=>{g=p,t(7,g)})}function X(p){ge[p?"unshift":"push"](()=>{k=p,t(2,k)})}return i.$$set=p=>{"app"in p&&t(0,n=p.app),"configManager"in p&&t(1,l=p.configManager),"linkHandler"in p&&t(16,u=p.linkHandler)},i.$$.update=()=>{i.$$.dirty&65540&&k&&u&&u.setPlaylist(k)},[n,l,k,o,s,c,a,g,_,v,N,y,M,V,U,C,u,$,X]}class hi extends Ce{constructor(e){super(),De(this,e,mi,ri,Ee,{app:0,configManager:1,linkHandler:16})}}exports.default=hi;
